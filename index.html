<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTE Regler Einstellhilfe</title>
	<link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f4f4f4;
        }
        h1 {
            color: #004080;
        }
        label {
            font-weight: bold;
        }
        input, button {
            margin-top: 10px;
            margin-bottom: 20px;
            padding: 8px;
            font-size: 16px;
        }
        .result {
            background-color: #fff;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
        }
        small {
            font-size: 12px;
            color: #777;
        }
        .slider-container {
            margin-top: 20px;
        }
        .slider {
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>TTE FW Regler Primär-Mischer-Einstellhilfe</h1>
    <h6>Experimentell Version 0.3</h6>
    <label for="laufzeit">Mischerlaufzeit (in Sekunden):</label><br>
    <input type="number" id="laufzeit" placeholder="z. B. 120" min="1"><br>

    <label for="nominalDurchfluss">Ventildurchfluss (m³/h):</label><br>
    <input type="number" id="nominalDurchfluss" placeholder="z. B. 8" min="0.1"><br>

    <label for="installiertDurchfluss">Gedrosselter Durchfluss (m³/h):</label><br>
    <input type="number" id="installiertDurchfluss" placeholder="z. B. 2" min="0.1"><br>

    <label for="experimentell">Experimentelle Funktionen aktivieren:</label>
    <input type="checkbox" id="experimentell" onchange="berechneWerte()"><br>

    <button onclick="berechneWerte()">Berechnen</button>

    <div class="slider-container">
        <label for="traegheit">Trägheitsfaktor: <span id="traegheitWert">0</span></label><br>
        <input type="range" id="traegheit" class="slider" min="-3" max="3" step="0.1" value="0" onchange="updateTraegheitWert()">
    </div>

    <div class="result" id="ergebnis" style="display:none;">
        <h2>Empfohlene Einstellungen:</h2>
        <p><strong>07-024 Mischerlaufzeit:</strong> <span id="mischerLaufzeit"></span> s</p>
        <p><small>(Laufzeit des Ventiles in Sekunden. Die Laufzeit muss für die Ventilberechnung exakt eingestellt werden.)</small></p>
        <p><strong>07-022 Laufzeit Regler:</strong> <span id="reglerLaufzeit"></span> s</p>
		<p><small>(Laufzeit des Mischer-Regelkreises. Beispiel: Die Laufzeit des Motors beträgt 120 Sekunden. Der eingestellte Wert 30 ist dann ¼ der gesamten Laufzeit, somit wird die Berechnung alle 30 Sekunden durchgeführt. Der eingestellte Wert sollte üblicherweise immer ¼ der Gesamtlaufzeit betragen.)</small></p>
        <p><strong>07-020 Nachstellzeit:</strong> <span id="nachstellzeit"></span> s</p>
        <p><small>(Parameter für den Integralteil der Mischerregelung des angegebenen Heizkreises. Die Nachstellzeit ist jene Zeit (in Sekunden) in der eine gegebene Soll-Ist-Differenz den gleichen Effekt auf den Mischer haben soll wie eine gleich grosse Proportional-Abweichung.)</small></p>
        <p><strong>07-021 P-Band:</strong> <span id="pband"></span> K</p>
        <p><small>(Parameter für den Proportionalteil der Mischerregelung für den angegebenen Heizkreis. Das P-Band ist jene Temperaturänderung die einen Vollausschlag (= 100 % Laufzeit) auf den Mischer haben soll.)</small></p>
    </div>

    <script>
        let traegheitFaktor = 0;

        function updateTraegheitWert() {
            traegheitFaktor = parseFloat(document.getElementById('traegheit').value);
            document.getElementById('traegheitWert').textContent = traegheitFaktor;
            berechneWerte();
        }

        function berechneWerte() {
            const laufzeit = parseFloat(document.getElementById('laufzeit').value);
            if (isNaN(laufzeit) || laufzeit <= 0) {
                alert("Bitte eine gültige Zahl für die Mischerlaufzeit eingeben.");
                return;
            }

            // Durchfluss-Skalierung
            let nominal = parseFloat(document.getElementById('nominalDurchfluss').value);
            let installiert = parseFloat(document.getElementById('installiertDurchfluss').value);
            let skalierung = 1;
            if (!isNaN(nominal) && !isNaN(installiert) && nominal > 0 && installiert > 0) {
                skalierung = installiert / nominal;
                if (skalierung > 1) skalierung = 1;
            }

            // Zusatzfaktor für Reglerlaufzeit
            let zusatzFaktor = 0;
            if (skalierung < 1) {
                zusatzFaktor = -1 * (1 - skalierung) / 0.75;
            }
            const angepassterTraegheit = traegheitFaktor + zusatzFaktor;

            // Berechnung für 07-022 Laufzeit Regler
            const reglerLaufzeit = Math.round(laufzeit / 4 + 10 * angepassterTraegheit);

            // Experimentelle Funktionen
            let nachstellzeit, pBand;
            const experimentell = document.getElementById('experimentell').checked;
            if (experimentell) {
                // Dynamische Berechnung
                nachstellzeit = Math.round(40 + 10 * angepassterTraegheit * (1 / skalierung));
                pBand = (laufzeit / 20 + 6 * skalierung).toFixed(1);
            } else {

                nachstellzeit = 40;
                pBand = 40;
            }

            // Ergebnisse anzeigen
            document.getElementById('mischerLaufzeit').textContent = laufzeit;
            document.getElementById('reglerLaufzeit').textContent = reglerLaufzeit;
            document.getElementById('nachstellzeit').textContent = nachstellzeit;
            document.getElementById('pband').textContent = pBand;
            document.getElementById('ergebnis').style.display = 'block';
        }
    </script>
</body>
</html>
